<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API í…ŒìŠ¤íŠ¸ í˜ì´ì§€</title>
    <style>
        body { font-family: sans-serif; line-height: 1.6; padding: 20px; max-width: 800px; margin: auto; }
        h1, h2 { text-align: center; }
        .container { background-color: #f4f4f4; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        label { font-weight: bold; display: block; margin-top: 10px; }
        input, textarea { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        textarea { height: 100px; }

        /* ì´ ë¶€ë¶„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. buttonê³¼ .button-link í´ë˜ìŠ¤ë¥¼ í•¨ê»˜ ìŠ¤íƒ€ì¼ë§í•©ë‹ˆë‹¤. */
        button, .button-link {
            background-color: #007bff;
            color: white !important; /* ë§í¬ì˜ ê¸°ë³¸ íŒŒë€ìƒ‰ ê¸€ì”¨ë¥¼ ë®ì–´ì“°ê¸° ìœ„í•´ !importantë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. */
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            text-decoration: none; /* ë§í¬ì˜ ë°‘ì¤„ì„ ì œê±°í•©ë‹ˆë‹¤. */
            display: inline-block;
        }
        button:hover, .button-link:hover {
            background-color: #0056b3;
        }

        #status, #result { margin-top: 20px; padding: 15px; background-color: #e9ecef; border: 1px solid #ced4da; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>

<h1>ğŸ“ FastAPI í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>

<div class="container">
    <h2>API ë¬¸ì„œ í™•ì¸ ğŸ“œ</h2>
    <p>FastAPIê°€ ìë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ëŠ” API ë¬¸ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
    <a href="/docs" target="_blank" class="button-link">Swagger</a>
    <a href="/redoc" target="_blank" class="button-link">ReDoc</a>
</div>

<div class="container">
    <h2>1. ì„œë²„ ìƒíƒœ</h2>
    <button onclick="getStatus()">ìƒíƒœ ìƒˆë¡œê³ ì¹¨</button>
    <div id="status">ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>
</div>

<div class="container">
    <h2>2. ëª¨ë¸ ì„ íƒ</h2>
    <button onclick="setModel('qwen')">Qwenìœ¼ë¡œ ë³€ê²½</button>
    <button onclick="setModel('mis')">MISë¡œ ë³€ê²½</button>
</div>

<div class="container">
    <h2>3. LLMì— ì§ˆë¬¸í•˜ê¸°</h2>
    <form id="askForm">
        <label for="context">ë¬¸ë§¥ (Context):</label>
        <textarea id="context" name="context">system ë„ˆëŠ” 3ê¸€ìë¡œë§Œ ë‹µë³€í•´ì•¼ë˜.</textarea>

        <label for="question">ì§ˆë¬¸ (Question):</label>
        <input type="text" id="question" name="question" value="ìƒì„±í˜• ai ë€ ë¬´ì—‡ì¸ì§€ ì„¤ëª…í•´ì¤˜">

        <button type="submit">ë‹µë³€ ìš”ì²­</button>
    </form>
    <h3>ê²°ê³¼:</h3>
    <div id="result">ì•„ì§ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
</div>

<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ìƒíƒœë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    window.onload = getStatus;

    // ì„œë²„ ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    async function getStatus() {
        const response = await fetch('/status');
        const data = await response.json();
        document.getElementById('status').textContent = `ìƒíƒœ: ${data.status}\në©”ì‹œì§€: ${data.message}\ní˜„ì¬ ëª¨ë¸: ${data.current_model}`;
    }

    // ëª¨ë¸ì„ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜
    async function setModel(modelName) {
        const response = await fetch(`/${modelName}`, { method: 'POST' });
        const data = await response.json();
        alert(data.message); // ë³€ê²½ ê²°ê³¼ë¥¼ alertë¡œ í‘œì‹œ
        await getStatus(); // ìƒíƒœë¥¼ ë‹¤ì‹œ ë¡œë“œí•˜ì—¬ ë³€ê²½ëœ ëª¨ë¸ì„ í™•ì¸
    }

    // '/ask' APIë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜
    document.getElementById('askForm').addEventListener('submit', async function(event) {
        event.preventDefault(); // í¼ì˜ ê¸°ë³¸ ì œì¶œ ë™ì‘ì„ ë§‰ìŠµë‹ˆë‹¤.

        const context = document.getElementById('context').value;
        const question = document.getElementById('question').value;
        const resultDiv = document.getElementById('result');

        resultDiv.textContent = 'ë‹µë³€ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...';

        try {
            const response = await fetch('/ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ context, question })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬');
            }

            const data = await response.json();
            resultDiv.textContent = JSON.stringify(data, null, 2);

        } catch (error) {
            resultDiv.textContent = `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
        }
        await getStatus(); // ì§ˆë¬¸ í›„ í˜„ì¬ ëª¨ë¸ ìƒíƒœ ì—…ë°ì´íŠ¸
    });
</script>
</body>
</html>